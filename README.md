Плагин API для LiveStreet CMS
=========================

Плагин предоставляет JSON интерфейс для основных функций LS.

# Описание API

API запросы: **/api/[module_name]/[method_name]/**  дополнительные параметры передаются через GET параметры.
Например, чтение топика: **/api/topic/read/?id=8149**
По дефолту ответ идет в дебаг виде, для отдачи в JSON дополнительно передаем **response_type=json**, например, **/api/topic/read/?id=8149&response_type=json**
Если в течение запроса возникла ошибка, то возвращает структуру:
``{‘bStateError’: true, ‘sMsg’: ‘text error’, ‘sMsgTitle’: ‘title error’}``

*Фильтр полей:* при запросе можно установить фильтр, что бы возвращались только нужные поля, фильтр задаётся в параметре fields, например,  **fields=topic_title,topic_id,user[user_id,user_login]**

## Модуль Common
Модуль common предоставляет методы авторизации пользователя:
### Метод login
Авторизация пользователя. Параметры: **login** - логин пользователя, **password** - пароль пользователя. В случае успеха возвращает ``{‘hash’: ‘dsgasd76gasdgas76ddgad’}`` , где **hash** - это ключ авторизации, его потом необходимо передавать параметром hash в запросы требующие авторизации пользователя. Ключ не ограничен по времени жизни, но он станет невалидным если юзер сменит себе пароль на сайте.
### Метод logout
Сброс авторизации пользователя (разлогинивание). Параметры: **hash** - ключ авторизации.

## Модуль Topic
Модуль для работы с топиками. Для всех методов возвращающих списки топиков (кроме top), можно задать параметры: **page** - номер текущей страницы, **per_page** - число топиков на страницу.
### Метод top
ТОП топиков в разрезе периодов. Параметры: **period** - значение периода, возможные варианты - *all*, *30d*, *7d*, *24h*.
В случае успеха возвращает структуру:
``{‘collection’: array topics, ‘count’: count all find topics}``
### Метод new
Новые топики.
В случае успеха возвращает структуру:
``{‘collection’: array topics, ‘count’: count all find topics}``
### Метод personal
Топики из персональных блогов. Параметры: **show_type** - тип возвращаемых топиков, возможные значения - *good*, *bad*, *new*.
### Метод blog
Топики из коллективных блогов + топики из конкретного коллективного блога. Параметры: **show_type** - тип возвращаемых топиков, возможные значения - *good*, *bad*, *new*; **blog_id** - id коллективного блога, если его передать, то топики будут браться только из этого блога.
В случае успеха возвращает структуру:
``{‘collection’: array topics, ‘count’: count all find topics}``
### Метод read
Получение топика по ID. Параметры: **id** - id топика.
В случае успеха возвращает структуру со всеми полями топика + связанные данные(автор, блог, голосование для авторизованного пользователя).
### Метод vote
Голосование за топик, необходима авторизация(передача параметра **hash**). Параметры: **id** - id топика, **value** - направление голосования, возможные значения - 0,1,-1.
В случае успеха возвращает структуру:
``{‘rating’: 23}``, где 23 - рейтинг топика после голосования.

## Модуль Comment
Модуль для работы с комментариями
### Метод list
Возвращает комментарии к топику. Параметры **id** - id топика, **type** = *topic*
Пример:  **/comment/list/?id=1234&type=topic**

## Модуль Geo
### Метод country
### Метод city
### Метод region
